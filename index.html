<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Mini Pinterest</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #fafafa;
    }
    header {
      padding: 15px;
      background: #e60023;
      color: white;
      text-align: center;
      font-size: 20px;
    }
    #controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px;
    }
    #controls input, #controls button {
      padding: 8px;
      font-size: 14px;
    }
    #gallery {
      column-count: 3;
      column-gap: 10px;
      margin: 10px;
    }
    .pin {
      background: white;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      overflow: hidden;
      break-inside: avoid;
    }
    .pin img {
      width: 100%;
      display: block;
    }
    .pin p {
      margin: 10px;
      font-size: 14px;
    }
    @media (max-width: 768px) {
      #gallery { column-count: 2; }
    }
    @media (max-width: 480px) {
      #gallery { column-count: 1; }
    }
  </style>
</head>
<body>
  <header>üìå Mini Pinterest</header>
  <div id="controls">
    <input type="text" id="imgUrl" placeholder="–í—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É">
    <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
    <button onclick="addPin()">–î–æ–±–∞–≤–∏—Ç—å</button>
    <button onclick="exportPins()">–≠–∫—Å–ø–æ—Ä—Ç</button>
    <input type="file" id="importFile" onchange="importPins(event)">
  </div>
  <div id="gallery"></div>

  <script>
    const gallery = document.getElementById("gallery");
    let pins = JSON.parse(localStorage.getItem("pins") || "[]");

    function normalizeLink(url) {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞: Google Drive —Å—Å—ã–ª–∫–∞
      const match = url.match(/https:\/\/drive\.google\.com\/file\/d\/([^/]+)/);
      if (match) {
        return `https://drive.google.com/uc?export=view&id=${match[1]}`;
      }
      return url;
    }

    function renderPins() {
      gallery.innerHTML = "";
      pins.forEach((pin, index) => {
        const div = document.createElement("div");
        div.className = "pin";
        div.innerHTML = `
          <img src="${pin.url}" alt="pin">
          <p>${pin.desc || ""}</p>
        `;
        gallery.appendChild(div);
      });
    }

    function addPin() {
      const urlInput = document.getElementById("imgUrl");
      const descInput = document.getElementById("desc");
      let url = urlInput.value.trim();
      let desc = descInput.value.trim();
      if (!url) return;
      url = normalizeLink(url);
      pins.push({ url, desc });
      localStorage.setItem("pins", JSON.stringify(pins));
      renderPins();
      urlInput.value = "";
      descInput.value = "";
    }

    function exportPins() {
      const data = JSON.stringify(pins);
      const blob = new Blob([data], {type: "application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "mypins.json";
      a.click();
    }

    function importPins(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          pins = JSON.parse(e.target.result);
          localStorage.setItem("pins", JSON.stringify(pins));
          renderPins();
        } catch(err) {
          alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ —Ñ–∞–π–ª–∞");
        }
      };
      reader.readAsText(file);
    }

    renderPins();
  </script>
</body>
</html>

<script>
  // ... –≤–µ—Å—å —Ç–≤–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ —Å—Ç—Ä–æ–∫–∏ —Å –ø–æ–∏—Å–∫–æ–º ...

  async function addPinFromKeyword(keyword){
    try{
      const directUrl = `https://source.unsplash.com/800x600/?${encodeURIComponent(keyword)}`;
      const id = uid();
      const dim = await probeImage(directUrl);
      pins.unshift({id, src:directUrl, title:keyword, w:dim.w, h:dim.h});
      save(); render();
    }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –∑–∞–ø—Ä–æ—Å—É'); console.error(e); }
  }

  // –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –ø–æ —Å—Å—ã–ª–∫–µ"
  $('#addUrl').addEventListener('click', ()=>{
    const u = $('#imgUrl').value.trim(); 
    const t = $('#imgTitle').value.trim();
    if(!u && t){ 
      // –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Äî –∏—â–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
      addPinFromKeyword(t); 
      $('#imgTitle').value='';
      return;
    }
    if(!u) return alert('–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ');
    addPinFromURL(u, t); 
    $('#imgUrl').value=''; 
    $('#imgTitle').value='';
  });

  // ... –≤–µ—Å—å —Ç–≤–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
</script>
